# Komunal-Dom - –£–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ê—Å–ø–µ–∫—Ç

AI-–¥–∏—Å–ø–µ—Ç—á–µ—Ä –¥–ª—è Telegram –∏ Web –Ω–∞ –±–∞–∑–µ Django + YandexGPT

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Backend:** Django 6.0, Python 3.12
- **Database:** PostgreSQL 16
- **Web Server:** nginx + gunicorn
- **AI:** YandexGPT API
- **Bot:** python-telegram-bot

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/vladimir-chernikin/komunal-dom.git
cd komunal-dom
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
cp .env.example .env
nano .env
```

### 4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
python manage.py migrate
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
python manage.py createsuperuser
```

### 6. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
./manage.sh run
```

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å Git (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û)

### üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –í–°–ï–• –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í:

**1. –ù–ò–ö–û–ì–î–ê –Ω–µ —Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –≤ –≤–µ—Ç–∫–µ `main`!**
- –í—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–¥–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö
- –í–µ—Ç–∫–∞ `main` —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞

**2. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

```bash
# –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é main
git checkout main
git pull origin main

# –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è –∑–∞–¥–∞—á–∏
git checkout -b feature/–∫—Ä–∞—Ç–∫–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-—Ñ–∏—á–∏
# –∏–ª–∏
git checkout -b bugfix/–∫—Ä–∞—Ç–∫–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–±–∞–≥–∞
# –∏–ª–∏
git checkout -b hotfix/—Å—Ä–æ—á–Ω–æ–µ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

# –®–∞–≥ 3: –í–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
# ... –∫–æ–¥ ...

# –®–∞–≥ 4: –ö–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ"

# –®–∞–≥ 5: –ü—É—à–∏—Ç—å –≤–µ—Ç–∫—É –≤ GitHub
git push origin feature/–∫—Ä–∞—Ç–∫–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-—Ñ–∏—á–∏

# –®–∞–≥ 6: –°–æ–∑–¥–∞—Ç—å Pull Request –Ω–∞ GitHub
```

**3. –°–æ–∑–¥–∞–Ω–∏–µ Pull Request (PR):**

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://github.com/vladimir-chernikin/komunal-dom
2. –ù–∞–∂–∞—Ç—å "Pull requests" ‚Üí "New pull request"
3. –í—ã–±—Ä–∞—Ç—å –≤–∞—à—É –≤–µ—Ç–∫—É
4. –ù–∞–ø–∏—Å–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
   - –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ?
   - –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?
   - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å?
5. –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–µ–≤—å—é–≤–µ—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
6. –î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è (Code Review)
7. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è - –≤–ª–∏—Ç—å –≤ main (Merge)

**4. –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤–µ—Ç–æ–∫:**

- `feature/xxx` - –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `bugfix/xxx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
- `hotfix/xxx` - —Å—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ production
- `refactor/xxx` - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞
- `docs/xxx` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `test/xxx` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

**5. –°–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤:**

–ü–∏—à–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º:

```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
"–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ incident_type"
"–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞"
"–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API"

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"fix"
"update"
"asdf"
```

**6. –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º PR:**

- [ ] –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ù–µ—Ç console.log –∏ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] –ù–µ—Ç –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- [ ] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±–ª—é–¥–µ–Ω–æ
- [ ] –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø–∏—Å–∞–Ω–æ

**7. Code Review:**

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —Ä–µ–≤—å—é
- –ú–∏–Ω–∏–º—É–º 1 –æ–¥–æ–±—Ä–µ–Ω–∏–µ –æ—Ç —Ä–µ–≤—å—é–≤–µ—Ä–∞
- –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

**8. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ —Å–ª–∏—è–Ω–∏–∏:**

–ü–µ—Ä–µ–¥ merg'–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ç–∫—É:

```bash
git checkout feature/–≤–∞—à–∞-–≤–µ—Ç–∫–∞
git fetch origin
git rebase origin/main
# –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
git push origin feature/–≤–∞—à–∞-–≤–µ—Ç–∫–∞ --force-with-lease
```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–µ—Ç–∫–∏

- `main` - –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞ (production-ready –∫–æ–¥, —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ PR)
- `feature/*` - –≤–µ—Ç–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á
- `bugfix/*` - –≤–µ—Ç–∫–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤
- `hotfix/*` - –≤–µ—Ç–∫–∏ –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ production
- `refactor/*` - –≤–µ—Ç–∫–∏ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- `docs/*` - –≤–µ—Ç–∫–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
komunal-dom/
‚îú‚îÄ‚îÄ komunal_dom/          # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç Django
‚îú‚îÄ‚îÄ portal/               # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–ª–∞ –£–ö
‚îú‚îÄ‚îÄ kladr/                # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ö–õ–ê–î–†
‚îú‚îÄ‚îÄ file_manager/         # –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
‚îú‚îÄ‚îÄ message_handler/      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π AI
‚îú‚îÄ‚îÄ venv/                 # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ media/                # –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ static/               # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ manage.py             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Django
```

## –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã AI

- **MainAgent** - –≥–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤–æ—Ä–æ–Ω–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
- **TagSearchService** - –Ω–µ—á–µ—Ç–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º
- **SemanticSearchService** - –ª–æ–≥–∏–∫–æ-—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- **VectorSearchService** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ
- **AIAgentService** - –ø–æ–∏—Å–∫ —Å –ø–æ–º–æ—â—å—é YandexGPT

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
python test_bot_simulator.py

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
python manage.py test

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∏–∞–ª–æ–≥–∞
python dialog_trace_service.py --session-id <session_id>
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - –£–ø—Ä–∞–≤–ª—è—é—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ê—Å–ø–µ–∫—Ç

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

- GitHub: https://github.com/vladimir-chernikin/komunal-dom
- –°–∞–π—Ç: https://komunal-dom.ru
