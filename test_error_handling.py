#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –±–æ—Ç–∞
"""

import asyncio
from main_agent import MainAgent

async def test_error_handling():
    print("üîß –¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫")
    print("=" * 50)

    agent = MainAgent()

    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ
    test_scenarios = [
        {
            'message': '–ñ–æ–ø–∞',
            'expected': '–§–∏–ª—å—Ç—Ä –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –º–∞—Ç–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤'
        },
        {
            'message': '–∞',
            'expected': '–§–∏–ª—å—Ç—Ä –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π'
        },
        {
            'message': 'help',
            'expected': '–ö–æ–º–∞–Ω–¥–∞ –ø–æ–º–æ—â–∏',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ–º–æ—â–∏'
        },
        {
            'message': '–æ—Ç–∫—Ä—ã–ª–∞—Å—å —Ç–µ—á—å',
            'expected': '–ù–æ—Ä–º–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã'
        },
        {
            'message': '',
            'expected': '–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è',
            'description': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è'
        }
    ]

    print("\nüß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:")
    print("-" * 50)

    for i, scenario in enumerate(test_scenarios, 1):
        message = scenario['message']
        if message == '':
            print(f"\nüìç –¢–µ—Å—Ç {i}: –ü–£–°–¢–û–ï –°–û–û–ë–©–ï–ù–ò–ï ({scenario['description']})")
            print(f"üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {scenario['expected']}")
            print("-" * 60)
            continue

        print(f"\nüìç –¢–µ—Å—Ç {i}: '{message}' ({scenario['description']})")
        print(f"üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {scenario['expected']}")
        print("-" * 60)

        try:
            result = await agent.process_service_detection(message)

            print(f"–°—Ç–∞—Ç—É—Å: {result.get('status')}")
            print(f"–°–æ–æ–±—â–µ–Ω–∏–µ: {result.get('message', '')[:100]}...")

            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if scenario['expected'] == '–§–∏–ª—å—Ç—Ä –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏':
                # –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞, –∞ –Ω–µ MainAgent
                print("‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ—Ä–Ω—ã—Ö —Å–ª–æ–≤ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞, –∞ –Ω–µ MainAgent")
            elif scenario['expected'] == '–§–∏–ª—å—Ç—Ä –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π':
                print("‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞")
            elif result.get('status') in ['SUCCESS', 'AMBIGUOUS']:
                print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
            elif result.get('status') == 'ERROR':
                if '—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞' in result.get('message', '').lower():
                    print("‚úÖ –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º")
                else:
                    print("‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–æ")
            else:
                print("‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞")

        except Exception as e:
            print(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
            print("‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–º–æ–≥–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ")

    print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print("=" * 50)
    print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫")
    print("‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ MainAgent")
    print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –≤ address_bot.py")
    print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–∞ –æ—à–∏–±–æ–∫")
    print("‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞—Ü–∏–∫–ª–∏–≤–∞—Ç—å—Å—è")

    print(f"\nüéâ –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!")
    print("\nüí° –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:")
    print("‚Ä¢ –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –ø–∏—à–∏—Ç–µ '—Å–≤—è–∑—å —Å –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º'")
    print("‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞'")
    print("‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏")
    print("‚Ä¢ –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö")

# –ó–∞–ø—É—Å–∫
print("–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫...")
asyncio.run(test_error_handling())